<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MediaTrends – Feed</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-p1PgAv17N6O9sF8K3dDQMbxIH4R+63KYN7Re8nYni81pw81+5w3FcqmKpEqc1m9Wp3+53dVHcLBHhzPU7XswIw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="script.js" defer></script>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const current = getCurrentUser();
      if (!current) {
        window.location.href = 'login.html';
        return;
      }
      // highlight active nav
      // We can't set class here because nav links are hard-coded with active class
      initDarkModeToggle('#darkModeBtn');
      document.getElementById('userDisplay').textContent = current.username;
      const postsContainer = document.getElementById('postsContainer');
      renderPosts(postsContainer);
      renderTrending();
      const form = document.getElementById('postForm');
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        const content = form.content.value;
        const result = createPost(content);
        if (result.success) {
          form.reset();
          renderPosts(postsContainer);
          renderTrending();
        }
      });
      document.getElementById('logoutBtn').addEventListener('click', () => {
        logoutUser();
        window.location.href = 'login.html';
      });
      function renderTrending() {
        const trendingEl = document.getElementById('trendingList');
        const topics = getTrendingTopics();
        trendingEl.innerHTML = '';
        if (topics.length === 0) {
          trendingEl.innerHTML = '<li>Nessun trend disponibile.</li>';
          return;
        }
        topics.forEach(topic => {
          const li = document.createElement('li');
          li.textContent = topic;
          trendingEl.appendChild(li);
        });
      }
    });
  </script>
  <style>
    .feed-grid {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 2rem;
    }
    @media (max-width: 900px) {
      .feed-grid {
        grid-template-columns: 1fr;
      }
    }
    .sidebar {
      background-color: var(--card-bg);
      padding: 1rem;
      border-radius: var(--card-border-radius);
      box-shadow: var(--card-box-shadow);
      height: fit-content;
    }
    .trending-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    .trending-list li {
      margin-bottom: 0.5rem;
      list-style: decimal inside;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="logo">MediaTrends</div>
    <ul>
      <li><a href="feed.html" class="active">Feed</a></li>
      <li><a href="profile.html">Profilo</a></li>
      <li><a href="about.html">Chi siamo</a></li>
      <li><button id="darkModeBtn" title="Toggle dark mode" style="background:none;border:none;color:var(--text-color);cursor:pointer"><i class="fas fa-moon"></i></button></li>
      <li><button id="logoutBtn" title="Logout" style="background:none;border:none;color:var(--text-color);cursor:pointer"><i class="fas fa-sign-out-alt"></i></button></li>
    </ul>
  </nav>
  <div class="container">
    <div class="top-bar">
      <h2>Benvenuto, <span id="userDisplay"></span>!</h2>
    </div>
    <div class="feed-grid">
      <!-- Feed column -->
      <div>
        <!-- Post form -->
        <div class="card post-form">
          <form id="postForm">
            <textarea name="content" placeholder="Cosa c'è di nuovo? Usa #hashtag per i trend" required></textarea>
            <button type="submit"><i class="fas fa-paper-plane"></i> Pubblica</button>
          </form>
        </div>
        <!-- Posts list -->
        <div class="card">
          <h3 class="mb-2">Ultimi post</h3>
          <div id="postsContainer"></div>
        </div>
      </div>
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="trending-title">Trend del momento</div>
        <ul id="trendingList" class="trending-list"></ul>
      </div>
    </div>
  </div>
  <footer>
    © 2025 MediaTrends. Tutti i diritti riservati.
  </footer>
</body>
</html>