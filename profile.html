<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MediaTrends – Profilo</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-p1PgAv17N6O9sF8K3dDQMbxIH4R+63KYN7Re8nYni81pw81+5w3FcqmKpEqc1m9Wp3+53dVHcLBHhzPU7XswIw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="script.js" defer></script>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const current = getCurrentUser();
      if (!current) {
        window.location.href = 'login.html';
        return;
      }
      initDarkModeToggle('#darkModeBtn');
      document.getElementById('profileName').textContent = current.username;
      document.getElementById('profileAvatar').textContent = current.username.charAt(0).toUpperCase();
      document.getElementById('bioInput').value = current.bio || '';
      document.getElementById('postsCount').textContent = getData('posts', []).filter(p => p.author === current.username).length;
      document.getElementById('followersCount').textContent = current.followers.length;
      document.getElementById('followingCount').textContent = current.following.length;
      renderUserPosts();
      document.getElementById('saveBioBtn').addEventListener('click', () => {
        const users = getData('users', {});
        users[current.username].bio = document.getElementById('bioInput').value.trim();
        setData('users', users);
        alert('Bio aggiornata!');
      });
      document.getElementById('logoutBtn').addEventListener('click', () => {
        logoutUser();
        window.location.href = 'login.html';
      });
      function renderUserPosts() {
        const container = document.getElementById('userPosts');
        container.innerHTML = '';
        const posts = getData('posts', []).filter(p => p.author === current.username);
        if (posts.length === 0) {
          container.innerHTML = '<p>Nessun post ancora.</p>';
          return;
        }
        posts.forEach(post => {
          const postEl = document.createElement('div');
          postEl.className = 'post';
          const liked = post.likes.includes(current.username);
          postEl.innerHTML = `
            <div class="post-header">
              <div class="avatar">${post.author.charAt(0).toUpperCase()}</div>
              <div>
                <strong>${post.author}</strong><br>
                <small>${timeAgo(post.timestamp)}</small>
              </div>
            </div>
            <div class="post-content mt-1">${escapeHtml(post.content).replace(/#(\w+)/g, '<span class="hashtag">#$1</span>')}</div>
            <div class="post-actions">
              <span class="like-button ${liked ? 'liked' : ''}" data-id="${post.id}">
                <i class="fa${liked ? 's' : 'r'} fa-heart"></i> ${post.likes.length}
              </span>
            </div>
          `;
          container.appendChild(postEl);
        });
        container.querySelectorAll('.like-button').forEach(el => {
          el.addEventListener('click', () => {
            const id = el.dataset.id;
            toggleLike(id);
            renderUserPosts();
          });
        });
      }
    });
  </script>
  <style>
    .profile-grid {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 2rem;
    }
    @media (max-width: 900px) {
      .profile-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="logo">MediaTrends</div>
    <ul>
      <li><a href="feed.html">Feed</a></li>
      <li><a href="profile.html" class="active">Profilo</a></li>
      <li><a href="about.html">Chi siamo</a></li>
      <li><button id="darkModeBtn" title="Toggle dark mode" style="background:none;border:none;color:var(--text-color);cursor:pointer"><i class="fas fa-moon"></i></button></li>
      <li><button id="logoutBtn" title="Logout" style="background:none;border:none;color:var(--text-color);cursor:pointer"><i class="fas fa-sign-out-alt"></i></button></li>
    </ul>
  </nav>
  <div class="container">
    <div class="profile-grid">
      <!-- Sidebar info -->
      <div class="card">
        <div class="profile-header">
          <div id="profileAvatar" class="profile-avatar"></div>
          <div class="profile-info">
            <h2 id="profileName"></h2>
            <div class="profile-stats">
              <span><strong id="postsCount">0</strong> post</span>
              <span><strong id="followersCount">0</strong> follower</span>
              <span><strong id="followingCount">0</strong> seguiti</span>
            </div>
          </div>
        </div>
        <div class="mt-2">
          <label for="bioInput"><strong>Bio</strong></label><br>
          <textarea id="bioInput" placeholder="Scrivi qualcosa su di te..."></textarea>
          <button id="saveBioBtn" class="mt-2">Salva Bio</button>
        </div>
      </div>
      <!-- User posts -->
      <div class="card">
        <h3 class="mb-2">I tuoi post</h3>
        <div id="userPosts"></div>
      </div>
    </div>
  </div>
  <footer>
    © 2025 MediaTrends. Tutti i diritti riservati.
  </footer>
</body>
</html>